function newArray(n) {
    for (var i = [], t = 0; t < n; t++) i[t] = {
        value: t
    };
    return i
}

function getbyteLenth(n) {
    for (var i = 0, r, t = 0; t < n.length; t++) r = n.charAt(t), i += /^[\u0000-\u00ff]$/.test(r) ? 1 : 2;
    return i
}

function MenuFormValidate() {
    $("#MenuForm").validate({
        rules: {
            name: {
                required: !0
            },
            value: {
                required: !1
            },
            pagepath: {
                required: !0
            },
            appid: {
                required: !0
            }
        },
        messages: {
            name: {
                required: "è¯·è¾“å…¥åç§°"
            },
            value: {
                required: $("#txtMenuButtonValue").attr("placeholder")
            },
            pagepath: {
                required: "è¯·è¾“å…¥å°ç¨‹åºçš„é¡µé¢è·¯å¾„"
            },
            appid: {
                required: "è¯·è¾“å…¥å°ç¨‹åºçš„AppId"
            }
        }
    })
}
$(function() {
    var n = {
        Type: ko.observable(1),
        TokenType: ko.observable(1),
        AccessToken: ko.observable(window.token),
        AppId: ko.observable(),
        AppSecret: ko.observable(),
        AgentId: ko.observable(),
        CorpId: ko.observable(),
        PermanentCode: ko.observable(),
        SuiteId: ko.observable(),
        SuiteSecret: ko.observable(),
        SuiteTicket: ko.observable(),
        Emojis: ko.observableArray("â˜€|â˜|â˜”|â›„|âš¡|ðŸŒ€|ðŸŒ|ðŸŒ‚|ðŸŒƒ|ðŸŒ„|ðŸŒ…|ðŸŒ†|ðŸŒ‡|ðŸŒˆ|â„|â›…|ðŸŒ‰|ðŸŒŠ|ðŸŒ‹|ðŸŒŒ|ðŸŒ|ðŸŒ‘|ðŸŒ”|ðŸŒ“|ðŸŒ™|ðŸŒ•|ðŸŒ›|ðŸŒŸ|ðŸŒ |ðŸ•|ðŸ•‘|ðŸ•’|ðŸ•“|ðŸ•”|ðŸ••|ðŸ•–|ðŸ•—|ðŸ•˜|ðŸ•™|ðŸ•š|ðŸ•›|âŒš|âŒ›|â°|â³|â™ˆ|â™‰|â™Š|â™‹|â™Œ|â™|â™Ž|â™|â™|â™‘|â™’|â™“|â›Ž|ðŸ€|ðŸŒ·|ðŸŒ±|ðŸ|ðŸŒ¸|ðŸŒ¹|ðŸ‚|ðŸƒ|ðŸŒº|ðŸŒ»|ðŸŒ´|ðŸŒµ|ðŸŒ¾|ðŸŒ½|ðŸ„|ðŸŒ°|ðŸŒ¼|ðŸŒ¿|ðŸ’|ðŸŒ|ðŸŽ|ðŸŠ|ðŸ“|ðŸ‰|ðŸ…|ðŸ†|ðŸˆ|ðŸ|ðŸ‡|ðŸ‘|ðŸ|ðŸ‘€|ðŸ‘‚|ðŸ‘ƒ|ðŸ‘„|ðŸ‘…|ðŸ’„|ðŸ’…|ðŸ’†|ðŸ’‡|ðŸ’ˆ|ðŸ‘¤|ðŸ‘¦|ðŸ‘§|ðŸ‘¨|ðŸ‘©|ðŸ‘ª|ðŸ‘«|ðŸ‘®|ðŸ‘¯|ðŸ‘°|ðŸ‘±|ðŸ‘²|ðŸ‘³|ðŸ‘´|ðŸ‘µ|ðŸ‘¶|ðŸ‘·|ðŸ‘¸|ðŸ‘¹|ðŸ‘º|ðŸ‘»|ðŸ‘¼|ðŸ‘½|ðŸ‘¾|ðŸ‘¿|ðŸ’€|ðŸ’|ðŸ’‚|ðŸ’ƒ|ðŸŒ|ðŸ|ðŸŽ|ðŸ”|ðŸ—|ðŸ«|ðŸ˜|ðŸ¨|ðŸ’|ðŸ‘|ðŸ™|ðŸš|ðŸ›|ðŸœ|ðŸ|ðŸž|ðŸ |ðŸ¡|ðŸ¢|ðŸ¤|ðŸ¥|ðŸ¦|ðŸ£|ðŸ§|ðŸ©|ðŸŸ|ðŸ¬|ðŸ­|ðŸ¯|ðŸ±|ðŸ³|ðŸ´|ðŸµ|ðŸ¶|ðŸ·|ðŸ»|ðŸ¹|ðŸº|ðŸ®|ðŸ°|ðŸ¸|ðŸ¾|ðŸ²|ðŸ¼|ðŸ½|ðŸ˜ |ðŸ˜©|ðŸ˜²|ðŸ˜ž|ðŸ˜µ|ðŸ˜°|ðŸ˜’|ðŸ˜|ðŸ˜¤|ðŸ˜œ|ðŸ˜|ðŸ˜‹|ðŸ˜˜|ðŸ˜š|ðŸ˜·|ðŸ˜³|ðŸ˜ƒ|ðŸ˜…|ðŸ˜†|ðŸ˜|ðŸ˜‚|ðŸ˜Š|â˜º|ðŸ˜„|ðŸ˜¢|ðŸ˜­|ðŸ˜¨|ðŸ˜£|ðŸ˜¡|ðŸ˜Œ|ðŸ˜–|ðŸ˜”|ðŸ˜±|ðŸ˜ª|ðŸ˜|ðŸ˜“|ðŸ˜¥|ðŸ˜«|ðŸ˜‰|ðŸ˜º|ðŸ˜¸|ðŸ˜¹|ðŸ˜½|ðŸ˜»|ðŸ˜¿|ðŸ˜¾|ðŸ˜¼|ðŸ™€|ðŸ™…|ðŸ™†|ðŸ™‡|ðŸ™ˆ|ðŸ™Š|ðŸ™‰|ðŸ™‹|ðŸ™Œ|ðŸ™|ðŸ™Ž|ðŸ™|ðŸ |ðŸ¡|ðŸ¢|ðŸ£|ðŸ¥|ðŸ¦|ðŸ§|ðŸ¨|ðŸ©|ðŸª|ðŸ«|â›ª|â›²|ðŸ¬|ðŸ¯|ðŸ°|ðŸ­|âš“|ðŸ®|ðŸ—»|ðŸ—¼|ðŸ—½|ðŸ—¾|ðŸ—¿|ðŸ‘ž|ðŸ‘Ÿ|ðŸ‘ |ðŸ‘¡|ðŸ‘¢|ðŸ‘£|ðŸ‘“|ðŸ‘•|ðŸ‘–|ðŸ‘‘|ðŸ‘”|ðŸ‘’|ðŸ‘—|ðŸ‘˜|ðŸ‘™|ðŸ‘š|ðŸ‘›|ðŸ‘œ|ðŸ‘|ðŸ’°|ðŸ’±|ðŸ’¹|ðŸ’²|ðŸ’³|ðŸ’´|ðŸ’µ|ðŸ’¸|-|-|-|-|-|-|-|-|-|-|ðŸ”¥|ðŸ”¦|ðŸ”§|ðŸ”¨|ðŸ”©|ðŸ”ª|ðŸ”«|ðŸ”®|ðŸ”¯|ðŸ”°|ðŸ”±|ðŸ’‰|ðŸ’Š|ðŸ…°|ðŸ…±|ðŸ†Ž|ðŸ…¾|ðŸŽ€|ðŸŽ|ðŸŽ‚|ðŸŽ„|ðŸŽ…|ðŸŽŒ|ðŸŽ†|ðŸŽˆ|ðŸŽ‰|ðŸŽ|ðŸŽŽ|ðŸŽ“|ðŸŽ’|ðŸŽ|ðŸŽ‡|ðŸŽ|ðŸŽƒ|ðŸŽŠ|ðŸŽ‹|ðŸŽ‘|ðŸ“Ÿ|â˜Ž|ðŸ“ž|ðŸ“±|ðŸ“²|ðŸ“|ðŸ“ |âœ‰|ðŸ“¨|ðŸ“©|ðŸ“ª|ðŸ“«|ðŸ“®|ðŸ“°|ðŸ“¢|ðŸ“£|ðŸ“¡|ðŸ“¤|ðŸ“¥|ðŸ“¦|ðŸ“§|ðŸ” |ðŸ”¡|ðŸ”¢|ðŸ”£|ðŸ”¤|âœ’|ðŸ’º|ðŸ’»|âœ|ðŸ“Ž|ðŸ’¼|ðŸ’½|ðŸ’¾|ðŸ’¿|ðŸ“€|âœ‚|ðŸ“|ðŸ“ƒ|ðŸ“„|ðŸ“…|ðŸ“|ðŸ“‚|ðŸ““|ðŸ“–|ðŸ“”|ðŸ“•|ðŸ“—|ðŸ“˜|ðŸ“™|ðŸ“š|ðŸ“›|ðŸ“œ|ðŸ“‹|ðŸ“†|ðŸ“Š|ðŸ“ˆ|ðŸ“‰|ðŸ“‡|ðŸ“Œ|ðŸ“’|ðŸ“|ðŸ“|ðŸ“‘|ðŸŽ½|âš¾|â›³|ðŸŽ¾|âš½|ðŸŽ¿|ðŸ€|ðŸ|ðŸ‚|ðŸƒ|ðŸ„|ðŸ†|ðŸˆ|ðŸŠ|ðŸšƒ|ðŸš‡|â“‚|ðŸš„|ðŸš…|ðŸš—|ðŸš™|ðŸšŒ|ðŸš|ðŸš¢|âœˆ|â›µ|ðŸš‰|ðŸš€|ðŸš¤|ðŸš•|ðŸšš|ðŸš’|ðŸš‘|ðŸš“|â›½|ðŸ…¿|ðŸš¥|ðŸš§|ðŸš¨|â™¨|â›º|ðŸŽ |ðŸŽ¡|ðŸŽ¢|ðŸŽ£|ðŸŽ¤|ðŸŽ¥|ðŸŽ¦|ðŸŽ§|ðŸŽ¨|ðŸŽ©|ðŸŽª|ðŸŽ«|ðŸŽ¬|ðŸŽ­|ðŸŽ®|ðŸ€„|ðŸŽ¯|ðŸŽ°|ðŸŽ±|ðŸŽ²|ðŸŽ³|ðŸŽ´|ðŸƒ|ðŸŽµ|ðŸŽ¶|ðŸŽ·|ðŸŽ¸|ðŸŽ¹|ðŸŽº|ðŸŽ»|ðŸŽ¼|ã€½|ðŸ“·|ðŸ“¹|ðŸ“º|ðŸ“»|ðŸ“¼|ðŸ’‹|ðŸ’Œ|ðŸ’|ðŸ’Ž|ðŸ’|ðŸ’|ðŸ’‘|ðŸ’’|ðŸ”ž|Â©|Â®|â„¢|â„¹|-|-|-|-|-|-|-|-|-|-|-|ðŸ”Ÿ|ðŸ“¶|ðŸ“³|ðŸ“´|ðŸ”|ðŸ™|ðŸ°|ðŸœ|ðŸž|ðŸ³|ðŸ¦|ðŸŸ|ðŸ¡|ðŸ˜|ðŸš|ðŸ|ðŸ›|ðŸ¢|ðŸ£|ðŸ±|ðŸ²|ðŸ§|ðŸ–|ðŸ¥|ðŸ |ðŸ•|ðŸ—|ðŸ¨|ðŸ©|ðŸª|ðŸ«|ðŸ¬|ðŸ­|ðŸ®|ðŸ¯|ðŸ¤|ðŸ´|â˜•|ðŸ¸|ðŸº|ðŸµ|ðŸ¶|ðŸ·|ðŸ»|ðŸ¹|â†—|â†˜|â†–|â†™|â¤´|â¤µ|â†”|â†•|â¬†|â¬‡|âž¡|â¬…|â–¶|â—€|â©|âª|â«|â¬|ðŸ”º|ðŸ”»|ðŸ”¼|ðŸ”½|â­•|âŒ|âŽ|â—|â‰|â€¼|â“|â”|â•|ã€°|âž°|-|â¤|ðŸ’“|ðŸ’”|ðŸ’•|ðŸ’–|ðŸ’—|ðŸ’˜|ðŸ’™|ðŸ’š|ðŸ’›|ðŸ’œ|ðŸ’|ðŸ’ž|ðŸ’Ÿ|â™¥|â™ |â™¦|â™£|ðŸš¬|ðŸš­|â™¿|ðŸš©|âš |â›”|â™»|ðŸš²|ðŸš¶|ðŸš¹|ðŸšº|ðŸ›€|ðŸš»|ðŸš½|ðŸš¾|ðŸš¼|ðŸšª|ðŸš«|âœ”|ðŸ†‘|ðŸ†’|ðŸ†“|ðŸ†”|ðŸ†•|ðŸ†–|ðŸ†—|ðŸ†˜|ðŸ†™|ðŸ†š|ðŸˆ|ðŸˆ‚|ðŸˆ²|ðŸˆ³|ðŸˆ´|ðŸˆµ|ðŸˆ¶|ðŸˆš|ðŸˆ·|ðŸˆ¸|ðŸˆ¹|ðŸˆ¯|ðŸˆº|ãŠ™|ãŠ—|ðŸ‰|ðŸ‰‘|âž•|âž–|âœ–|âž—|ðŸ’ |ðŸ’¡|ðŸ’¢|ðŸ’£|ðŸ’¤|ðŸ’¥|ðŸ’¦|ðŸ’§|ðŸ’¨|ðŸ’©|ðŸ’ª|ðŸ’«|ðŸ’¬|âœ¨|âœ´|âœ³|âšª|âš«|ðŸ”´|ðŸ”µ|ðŸ”²|ðŸ”³|â­|â¬œ|â¬›|â–«|â–ª|â—½|â—¾|â—»|â—¼|ðŸ”¶|ðŸ”·|ðŸ”¸|ðŸ”¹|â‡|ðŸ’®|ðŸ’¯|â†©|â†ª|ðŸ”ƒ|ðŸ”Š|ðŸ”‹|ðŸ”Œ|ðŸ”|ðŸ”Ž|ðŸ”’|ðŸ”“|ðŸ”|ðŸ”|ðŸ”‘|ðŸ””|â˜‘|ðŸ”˜|ðŸ”–|ðŸ”—|ðŸ”™|ðŸ”š|ðŸ”›|ðŸ”œ|ðŸ”|âœ…|âœŠ|âœ‹|âœŒ|ðŸ‘Š|ðŸ‘|â˜|ðŸ‘†|ðŸ‘‡|ðŸ‘ˆ|ðŸ‘‰|ðŸ‘‹|ðŸ‘|ðŸ‘Œ|ðŸ‘Ž|ðŸ‘".split("|")),
        SelectEmoji: function(n, t) {
            t.stopPropagation();
            var i = $("#selectEmojidiv");
            if (i.is(":visible")) i.hide(), $("html").unbind("click");
            else {
                $("html").one("click", function(n) {
                    n.stopPropagation();
                    i.hide()
                });
                i.show()
            }
        },
        ClickEmojiDiv: function(n, t) {
            t.stopPropagation()
        },
        ClickEmoji: function(n) {
            var t = $("#txtMenuName"),
                i = $("#selectEmojidiv");
            t.val(t.val() + n).trigger("keyup");
            i.hide()
        },
        Menus: ko.observable(),
        MenusReset: function() {
            var t = JSON.stringify(n.Menus());
            n.Menus(undefined);
            n.Menus(JSON.parse(t));
            MenuFormValidate()
        },
        MenuIndex: ko.observable(),
        isEditMenu: ko.observable(!1),
        isSaveMenu: ko.observable(!0),
        BottonIndex: ko.observable(-1),
        SubBottonIndex: ko.observable(-1),
        Menu: ko.observable(),
        InputMenu: ko.observable(),
        EditMenuType: ko.observable(),
        MenuTypeChange: function(t, i) {
            var e = $(i.currentTarget).find("option:selected"),
                f, u, r;
            $("#txtMenuButtonValue").attr("placeholder", e.attr("pl"));
            f = e.attr("value");
            f === "miniprogram" && (u = n.Menu(), u.pagepath == undefined && u.appid == undefined && (u.pagepath = "", u.appid = ""));
            n.EditMenuType(f);
            r = "";
            switch (f) {
                case "view":
                    r = "è·³è½¬URLç”¨æˆ·ç‚¹å‡»viewç±»åž‹æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†ä¼šæ‰“å¼€å¼€å‘è€…åœ¨æŒ‰é’®ä¸­å¡«å†™çš„ç½‘é¡µURLï¼Œå¯ä¸Žç½‘é¡µæŽˆæƒèŽ·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯æŽ¥å£ç»“åˆï¼ŒèŽ·å¾—ç”¨æˆ·åŸºæœ¬ä¿¡æ¯";
                    break;
                case "click":
                    r = "ç‚¹å‡»æŽ¨äº‹ä»¶ç”¨æˆ·ç‚¹å‡»clickç±»åž‹æŒ‰é’®åŽï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šé€šè¿‡æ¶ˆæ¯æŽ¥å£æŽ¨é€æ¶ˆæ¯ç±»åž‹ä¸ºeventçš„ç»“æž„ç»™å¼€å‘è€…ï¼ˆå‚è€ƒæ¶ˆæ¯æŽ¥å£æŒ‡å—ï¼‰ï¼Œå¹¶ä¸”å¸¦ä¸ŠæŒ‰é’®ä¸­å¼€å‘è€…å¡«å†™çš„keyå€¼ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„keyå€¼ä¸Žç”¨æˆ·è¿›è¡Œäº¤äº’";
                    break;
                case "scancode_push":
                    r = "æ‰«ç æŽ¨äº‹ä»¶ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†è°ƒèµ·æ‰«ä¸€æ‰«å·¥å…·ï¼Œå®Œæˆæ‰«ç æ“ä½œåŽæ˜¾ç¤ºæ‰«æç»“æžœï¼ˆå¦‚æžœæ˜¯URLï¼Œå°†è¿›å…¥URLï¼‰ï¼Œä¸”ä¼šå°†æ‰«ç çš„ç»“æžœä¼ ç»™å¼€å‘è€…ï¼Œå¼€å‘è€…å¯ä»¥ä¸‹å‘æ¶ˆæ¯";
                    break;
                case "scancode_waitmsg":
                    r = "æ‰«ç æŽ¨äº‹ä»¶ä¸”å¼¹å‡ºâ€œæ¶ˆæ¯æŽ¥æ”¶ä¸­â€æç¤ºæ¡†ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†è°ƒèµ·æ‰«ä¸€æ‰«å·¥å…·ï¼Œå®Œæˆæ‰«ç æ“ä½œåŽï¼Œå°†æ‰«ç çš„ç»“æžœä¼ ç»™å¼€å‘è€…ï¼ŒåŒæ—¶æ”¶èµ·æ‰«ä¸€æ‰«å·¥å…·ï¼Œç„¶åŽå¼¹å‡ºâ€œæ¶ˆæ¯æŽ¥æ”¶ä¸­â€æç¤ºæ¡†ï¼ŒéšåŽå¯èƒ½ä¼šæ”¶åˆ°å¼€å‘è€…ä¸‹å‘çš„æ¶ˆæ¯";
                    break;
                case "pic_sysphoto":
                    r = "å¼¹å‡ºç³»ç»Ÿæ‹ç…§å‘å›¾ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†è°ƒèµ·ç³»ç»Ÿç›¸æœºï¼Œå®Œæˆæ‹ç…§æ“ä½œåŽï¼Œä¼šå°†æ‹æ‘„çš„ç›¸ç‰‡å‘é€ç»™å¼€å‘è€…ï¼Œå¹¶æŽ¨é€äº‹ä»¶ç»™å¼€å‘è€…ï¼ŒåŒæ—¶æ”¶èµ·ç³»ç»Ÿç›¸æœºï¼ŒéšåŽå¯èƒ½ä¼šæ”¶åˆ°å¼€å‘è€…ä¸‹å‘çš„æ¶ˆæ¯";
                    break;
                case "pic_photo_or_album":
                    r = "å¼¹å‡ºæ‹ç…§æˆ–è€…ç›¸å†Œå‘å›¾ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†å¼¹å‡ºé€‰æ‹©å™¨ä¾›ç”¨æˆ·é€‰æ‹©â€œæ‹ç…§â€æˆ–è€…â€œä»Žæ‰‹æœºç›¸å†Œé€‰æ‹©â€ã€‚ç”¨æˆ·é€‰æ‹©åŽå³èµ°å…¶ä»–ä¸¤ç§æµç¨‹";
                    break;
                case "pic_weixin":
                    r = "å¼¹å‡ºå¾®ä¿¡ç›¸å†Œå‘å›¾å™¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†è°ƒèµ·å¾®ä¿¡ç›¸å†Œï¼Œå®Œæˆé€‰æ‹©æ“ä½œåŽï¼Œå°†é€‰æ‹©çš„ç›¸ç‰‡å‘é€ç»™å¼€å‘è€…çš„æœåŠ¡å™¨ï¼Œå¹¶æŽ¨é€äº‹ä»¶ç»™å¼€å‘è€…ï¼ŒåŒæ—¶æ”¶èµ·ç›¸å†Œï¼ŒéšåŽå¯èƒ½ä¼šæ”¶åˆ°å¼€å‘è€…ä¸‹å‘çš„æ¶ˆæ¯";
                    break;
                case "location_select":
                    r = "å¼¹å‡ºåœ°ç†ä½ç½®é€‰æ‹©å™¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†è°ƒèµ·åœ°ç†ä½ç½®é€‰æ‹©å·¥å…·ï¼Œå®Œæˆé€‰æ‹©æ“ä½œåŽï¼Œå°†é€‰æ‹©çš„åœ°ç†ä½ç½®å‘é€ç»™å¼€å‘è€…çš„æœåŠ¡å™¨ï¼ŒåŒæ—¶æ”¶èµ·ä½ç½®é€‰æ‹©å·¥å…·ï¼ŒéšåŽå¯èƒ½ä¼šæ”¶åˆ°å¼€å‘è€…ä¸‹å‘çš„æ¶ˆæ¯";
                    break;
                case "media_id":
                    r = "ä¸‹å‘æ¶ˆæ¯ï¼ˆé™¤æ–‡æœ¬æ¶ˆæ¯ï¼‰ç”¨æˆ·ç‚¹å‡»media_idç±»åž‹æŒ‰é’®åŽï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šå°†å¼€å‘è€…å¡«å†™çš„æ°¸ä¹…ç´ æidå¯¹åº”çš„ç´ æä¸‹å‘ç»™ç”¨æˆ·ï¼Œæ°¸ä¹…ç´ æç±»åž‹å¯ä»¥æ˜¯å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€å›¾æ–‡æ¶ˆæ¯ã€‚è¯·æ³¨æ„ï¼šæ°¸ä¹…ç´ æidå¿…é¡»æ˜¯åœ¨â€œç´ æç®¡ç†/æ–°å¢žæ°¸ä¹…ç´ æâ€æŽ¥å£ä¸Šä¼ åŽèŽ·å¾—çš„åˆæ³•id";
                    break;
                case "view_limited":
                    r = "è·³è½¬å›¾æ–‡æ¶ˆæ¯URLç”¨æˆ·ç‚¹å‡»view_limitedç±»åž‹æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†æ‰“å¼€å¼€å‘è€…åœ¨æŒ‰é’®ä¸­å¡«å†™çš„æ°¸ä¹…ç´ æidå¯¹åº”çš„å›¾æ–‡æ¶ˆæ¯URLï¼Œæ°¸ä¹…ç´ æç±»åž‹åªæ”¯æŒå›¾æ–‡æ¶ˆæ¯ã€‚è¯·æ³¨æ„ï¼šæ°¸ä¹…ç´ æidå¿…é¡»æ˜¯åœ¨â€œç´ æç®¡ç†/æ–°å¢žæ°¸ä¹…ç´ æâ€æŽ¥å£ä¸Šä¼ åŽèŽ·å¾—çš„åˆæ³•id";
                    break;
                case "miniprogram":
                    r = "æ‰“å¼€å°ç¨‹åºç”¨æˆ·ç‚¹å‡»æŒ‰é’®åŽï¼Œå¾®ä¿¡å®¢æˆ·ç«¯å°†ä¼šæ‰“å¼€å¼€å‘è€…åœ¨æŒ‰é’®ä¸­æ‰€å¡«å†™çš„PagePathå°ç¨‹åºçš„é¡µé¢ï¼Œä¸æ”¯æŒå°ç¨‹åºçš„è€ç‰ˆæœ¬å®¢æˆ·ç«¯å°†æ‰“å¼€åœ¨æŒ‰é’®ä¸­å¡«å†™çš„URL";
                    break;
                default:
                    r = ""
            }
            $(i.currentTarget).tooltip("destroy");
            $(i.currentTarget).tooltip({
                title: r,
                animation: !1
            })
        },
        CopyMenu: ko.observable(),
        Copy: function() {
            if (n.Menu() != undefined) {
                var t = JSON.stringify(n.Menu());
                n.CopyMenu(JSON.parse(t));
                n.Menu(undefined)
            }
        },
        Paste: function() {
            if (n.CopyMenu() != undefined) {
                var t = JSON.parse(JSON.stringify(n.CopyMenu()));
                (n.SubBottonIndex() === -1 || t.sub_button == undefined) && (n.isEditMenu() || n.MenuIndex() == undefined) || delete t.sub_button;
                n.Menu(t);
                MenuFormValidate()
            }
        },
        Up: function() {
            var t = n.BottonIndex(),
                r = n.SubBottonIndex(),
                i = r - 1;
            n.Menus().button[t].sub_button[r] = n.Menus().button[t].sub_button[i];
            n.Menus().button[t].sub_button[i] = n.Menu();
            n.MenusReset();
            n.SubBottonIndex(i)
        },
        Down: function() {
            var t = n.BottonIndex(),
                r = n.SubBottonIndex(),
                i = r + 1;
            n.Menus().button[t].sub_button[r] = n.Menus().button[t].sub_button[i];
            n.Menus().button[t].sub_button[i] = n.Menu();
            n.MenusReset();
            n.SubBottonIndex(i)
        },
        Left: function() {
            var i = n.BottonIndex(),
                r = n.SubBottonIndex(),
                t;
            r === -1 && (t = i - 1, n.Menus().button[i] = n.Menus().button[t], n.Menus().button[t] = n.Menu(), n.MenusReset(), n.BottonIndex(t))
        },
        Right: function() {
            var i = n.BottonIndex(),
                r = n.SubBottonIndex(),
                t;
            r === -1 && (t = i + 1, n.Menus().button[i] = n.Menus().button[t], n.Menus().button[t] = n.Menu(), n.MenusReset(), n.BottonIndex(t))
        },
        EditMenu: function(t, i, r) {
            n.BottonIndex(i);
            n.SubBottonIndex(r);
            n.isEditMenu(!0);
            var f = JSON.stringify(t),
                u = JSON.parse(f);
            u.sub_button != undefined && u.sub_button.length > 0 ? u.type !== "menu" && (u.otype = u.type, u.type = "menu") : u.type === "menu" && (u.type = u.otype);
            n.Menu(u)
        },
        AddMenu: function(t) {
            n.BottonIndex(-1);
            n.SubBottonIndex(-1);
            n.isEditMenu(!1);
            n.MenuIndex(t);
            n.Menu({
                type: "view",
                name: "",
                value: ""
            })
        },
        DeleteMenu: function() {
            $(n.Menus().button).each(function(t, i) {
                t === n.BottonIndex() && n.SubBottonIndex() === -1 && n.Menus().button.splice(t, 1);
                i.sub_button instanceof Array && $(i.sub_button).each(function(r) {
                    t === n.BottonIndex() && r === n.SubBottonIndex() && i.sub_button.splice(r, 1)
                })
            });
            n.Menu(undefined);
            n.MenuIndex(undefined);
            n.BottonIndex(-1);
            n.SubBottonIndex(-1);
            n.MenusReset()
        },
        CancelMenuSave: function() {
            n.Menu(undefined);
            n.MenuIndex(undefined);
            n.BottonIndex(-1);
            n.SubBottonIndex(-1)
        },
        MenuSave: function() {
            if ($("#MenuForm").data("validator").form() && n.NameErrorMessage() == undefined && n.ValueErrorMessage() == undefined) {
                if (n.isEditMenu()) {
                    var t = n.BottonIndex(),
                        i = n.SubBottonIndex();
                    i === -1 ? n.Menus().button[t] = n.Menu() : n.Menus().button[t].sub_button[i] = n.Menu()
                } else n.MenuIndex() != undefined ? (n.Menus().button[n.MenuIndex()].sub_button == undefined && (n.Menus().button[n.MenuIndex()].sub_button = []), n.Menus().button[n.MenuIndex()].sub_button.unshift(n.Menu())) : n.Menus().button.push(n.Menu());
                n.Menu(undefined);
                n.MenuIndex(undefined);
                n.BottonIndex(-1);
                n.SubBottonIndex(-1);
                n.MenusReset()
            }
        },
        TrimMenuButton: function(n) {
            var t = {};
            return (n.sub_button == undefined || n.sub_button.length === 0) && (n.type === "menu" && (n.type = n.otype), t.type = n.type, n.type === "view" || n.type === "miniprogram" ? (t.url = n.value, n.type === "miniprogram" && (t.appid = n.appid, t.pagepath = n.pagepath)) : n.type === "media_id" || n.type === "view_limited" ? t.media_id = n.value : t.key = n.value), t.name = n.name, t
        },
        InitMenuButton: function(n) {
            var t = {};
            return t.type = n.type != undefined ? n.type : "menu", t.name = n.name, n.type === "view" || n.type === "miniprogram" ? (t.value = n.url, n.type === "miniprogram" && (t.appid = n.appid, t.pagepath = n.pagepath)) : t.value = n.type === "media_id" || n.type === "view_limited" ? n.media_id : n.key || "", t
        },
        InitMenus: function(t) {
            var i = {
                button: []
            };
            try {
                if (t.button == undefined) throw "æ ¼å¼é”™è¯¯";
                $(t.button).each(function(t, r) {
                    var u = n.InitMenuButton(r);
                    r.sub_button instanceof Array && r.sub_button.length > 0 && (u.sub_button = [], $(r.sub_button).each(function(t, i) {
                        u.sub_button.push(n.InitMenuButton(i))
                    }));
                    i.button.push(u)
                })
            } catch (r) {
                alert("è¯·å‚ç…§ä¸‹æ–¹å®žæ—¶JSONè¾“å…¥æ­£ç¡®çš„èœå•æ•°æ®")
            }
            return i
        },
        ConfirmInputMenu: function() {
            var t = n.InputMenu() || "",
                i, r;
            if ($.trim(t).length === 0) {
                alert("è¯·è¾“å…¥èœå•æ•°æ®");
                return
            }
            try {
                i = JSON.parse(t);
                r = n.InitMenus(i);
                n.Menu(undefined);
                n.MenuIndex(undefined);
                n.BottonIndex(-1);
                n.SubBottonIndex(-1);
                n.Menus(undefined);
                n.Menus(r);
                $("#InputJSONModel").modal("hide")
            } catch (u) {
                alert("è¯·è¾“å…¥æ­£ç¡®çš„èœå•æ•°æ®")
            }
        },
        EditMenus: function(t) {
            var r;
            if (t == undefined) r = {}, r.button = [], n.Menus(r);
            else {
                var u = n.AppId(),
                    f = n.AppSecret(),
                    e = n.AccessToken(),
                    o = n.Type(),
                    i = n.TokenType(),
                    s = n.CorpId(),
                    h = n.PermanentCode(),
                    c = n.AgentId(),
                    l = n.SuiteId(),
                    a = n.SuiteSecret(),
                    v = n.SuiteTicket();
                if (o === "1" && i === "2") {
                    if (u == undefined || $.trim(u).length === 0) {
                        alert("è¯·è¾“å…¥AppId");
                        return
                    }
                    if (f == undefined || $.trim(f).length === 0) {
                        alert("è¯·è¾“å…¥AppSecret");
                        return
                    }
                } else if (o === "2" && i === "2") {
                    if (s == undefined || $.trim(s).length === 0) {
                        alert("è¯·è¾“å…¥CorpId");
                        return
                    }
                    if (h == undefined || $.trim(h).length === 0) {
                        alert("è¯·è¾“å…¥æ°¸ä¹…æŽˆæƒç ");
                        return
                    }
                    if (c == undefined || $.trim(c).length === 0) {
                        alert("è¯·è¾“å…¥AgentId");
                        return
                    }
                    if (l == undefined || $.trim(l).length === 0) {
                        alert("è¯·è¾“å…¥SuiteId");
                        return
                    }
                    if (a == undefined || $.trim(a).length === 0) {
                        alert("è¯·è¾“å…¥SuiteSecret");
                        return
                    }
                    if (v == undefined || $.trim(v).length === 0) {
                        alert("è¯·è¾“å…¥SuiteTicket");
                        return
                    }
                }
                //else if (i === "1" && (e == undefined || $.trim(e).length === 0)) {
                 //   alert("è¯·è¾“å…¥AccessToken");
                 //   return
                //}
                $("#btnQueryMenu").button("æŸ¥è¯¢ä¸­...");
                $.ajax({
                    url: "/wxApi/getMenu",
                    datatype: "JSON",
                    type: "POST",
                    async: !0,
                    data: JSON.stringify({
                        appId: u,
                        appSecret: f,
                        accessToken: e,
                        type: o,
                        tokenType: i,
                        corpId: s,
                        permanentCode: h,
                        agentId: c,
                        suiteId: l,
                        suiteSecret: a,
                        suiteTicket: v
                    }),
                    contentType: "application/json; charset=UTF-8",
                    success: function(t) {
                        if ($("#btnQueryMenu").button("reset")) {
                            var i = t.data,
                                //r = JSON.parse(i).menu,
                                r = JSON.parse(i),
                                u = n.InitMenus(r);
                            n.Menu(undefined);
                            n.MenuIndex(undefined);
                            n.BottonIndex(-1);
                            n.SubBottonIndex(-1);
                            n.Menus(undefined);
                            n.Menus(u)
                        } else alert(t.messages)
                    },
                    error: function(n, t, i) {
                        $("#btnQueryMenu").button("reset");
                        console.error(i)
                    }
                })
            }
        },
        SaveMenus: function() {
            var c = n.NewMenu(),
                i = n.AppId(),
                r = n.AppSecret(),
                u = n.AccessToken(),
                f = n.Type(),
                t = n.TokenType(),
                e = n.AgentId(),
                o = n.SuiteId(),
                s = n.SuiteSecret(),
                h = n.SuiteTicket();
            if (f === "1" && t === "2") {
                if (i == undefined || $.trim(i).length === 0) {
                    alert("è¯·è¾“å…¥AppId");
                    return
                }
                if (r == undefined || $.trim(r).length === 0) {
                    alert("è¯·è¾“å…¥AppSecret");
                    return
                }
            } else if (f === "2" && t === "2") {
                if (e == undefined || $.trim(e).length === 0) {
                    alert("è¯·è¾“å…¥AgentId");
                    return
                }
                if (o == undefined || $.trim(o).length === 0) {
                    alert("è¯·è¾“å…¥SuiteId");
                    return
                }
                if (s == undefined || $.trim(s).length === 0) {
                    alert("è¯·è¾“å…¥SuiteSecret");
                    return
                }
                if (h == undefined || $.trim(h).length === 0) {
                    alert("è¯·è¾“å…¥SuiteTicket");
                    return
                }
            } 
            //else if (t === "1" && (u == undefined || $.trim(u).length === 0)) {
                //alert("è¯·è¾“å…¥AccessToken");
                //return
            //}
            $("#btnSubmitMenu").button("å‘å¸ƒä¸­...");
            $.ajax({
                url: "/wxApi/createMenu",
                datatype: "JSON",
                type: "POST",
                async: !0,
                data: {
                    appId: i,
                    appSecret: r,
                    accessToken: u,
                    type: f,
                    tokenType: t,
                    agentId: e,
                    suiteId: o,
                    suiteSecret: s,
                    suiteTicket: h,
                    menu: JSON.stringify(c)
                },
                success: function(n) {
                    $("#btnSubmitMenu").button("reset");
                    n.success ? alert("å‘å¸ƒæˆåŠŸ") : alert(n.messages)
                },
                error: function(n, t, i) {
                    $("#btnSubmitMenu").button("reset");
                    console.error(i)
                }
            })
        }
    };
    n.IsPaste = ko.dependentObservable(function() {
        return this.CopyMenu() != undefined
    }, n);
    n.IsUp = ko.dependentObservable(function() {
        return this.SubBottonIndex() > 0
    }, n);
    n.IsDown = ko.dependentObservable(function() {
        return this.Menus() == undefined ? !1 : this.BottonIndex() >= 0 && this.SubBottonIndex() >= 0 && this.Menus().button[this.BottonIndex()].sub_button != undefined && this.SubBottonIndex() < this.Menus().button[this.BottonIndex()].sub_button.length - 1
    }, n);
    n.IsLeft = ko.dependentObservable(function() {
        return this.BottonIndex() > 0 && this.SubBottonIndex() === -1
    }, n);
    n.IsRight = ko.dependentObservable(function() {
        return this.Menus() == undefined ? !1 : this.BottonIndex() >= 0 && this.BottonIndex() < this.Menus().button.length - 1 && this.SubBottonIndex() === -1
    }, n);
    n.SelectedCss = ko.dependentObservable(function() {
        var n = this.BottonIndex(),
            t = this.SubBottonIndex();
        $("div.list-group-item").removeClass("list-group-item-selected");
        n >= 0 && (t >= 0 ? $("div.list-group-item[bottonindex=" + n + "][subbottonindex=" + t + "]").addClass("list-group-item-selected") : $("div.list-group-item[bottonindex=" + n + "]").addClass("list-group-item-selected"))
    }, n);
    n.NameErrorMessage = ko.observable();
    n.EventNameErrorMessage = function(t, i) {
        var r, f, u, e, o;
        $(i.currentTarget).trigger("change");
        n.Menu() != undefined ? (r = !1, n.isEditMenu() ? (f = n.SubBottonIndex(), r = f === -1 ? !0 : !1) : r = n.MenuIndex() != undefined ? !1 : !0, u = 0, u = r ? 16 : 60, e = n.Menu().name, o = getbyteLenth(e), o > u ? (n.NameErrorMessage("å·²è¶…å‡ºæœ€å¤§é•¿åº¦"), $(i.currentTarget).popover({
            trigger: "manual",
            animation: !1
        }), $(i.currentTarget).popover("show")) : ($(i.currentTarget).popover("destroy"), n.NameErrorMessage(undefined))) : ($(i.currentTarget).popover("destroy"), n.NameErrorMessage(undefined))
    };
    n.ValueErrorMessage = ko.observable();
    n.EventValueErrorMessage = function(t, i) {
        var r, f, u, e, o;
        $(i.currentTarget).trigger("change");
        n.Menu() != undefined ? (r = 0, f = n.Menu().type, f === "view" ? r = 1024 : (u = parseInt(n.Type()), u === 1 ? r = 128 : u === 2 && (r = 256)), e = n.Menu().value, o = getbyteLenth(e), o > r ? (n.ValueErrorMessage("å·²è¶…å‡ºæœ€å¤§é•¿åº¦"), $(i.currentTarget).popover({
            trigger: "manual",
            animation: !1
        }), $(i.currentTarget).popover("show")) : ($(i.currentTarget).popover("destroy"), n.ValueErrorMessage(undefined))) : ($(i.currentTarget).popover("destroy"), n.ValueErrorMessage(undefined))
    };
    n.NewMenu = ko.dependentObservable(function() {
        if (this.Menus() == undefined) return undefined;
        var t = {
            button: []
        }, i = JSON.parse(JSON.stringify(this.Menus()));
        return $(i.button).each(function(i, r) {
            var u = n.TrimMenuButton(r);
            r.sub_button instanceof Array && r.sub_button.length > 0 && (u.sub_button = [], $(r.sub_button).each(function(t, i) {
                u.sub_button.push(n.TrimMenuButton(i))
            }));
            t.button.push(u)
        }), t
    }, n);
    n.Menu.subscribe(function(t) {
        if (t != undefined) {
            var i = t.type;
            i !== "miniprogram" && n.EditMenuType(i);
            setTimeout(function() {
                n.EditMenuType(i);
                MenuFormValidate();
                $("#selectMenuType").trigger("change")
            }, 100)
        }
    });
    n.EditMenus();
    ko.applyBindings(n, document.getElementById("divMain"));
    ko.applyBindings(n, document.getElementById("jsonShow"));
    ko.applyBindings(n, document.getElementById("InputJSONModel"));
    MenuFormValidate();
    $("#divMenu").show();
    $.LoadingHide();
    $("#selType").change(function() {
        $(this).val() === "2" ? $("#selTokenType").val("1").trigger("change") : $("#selTokenType").removeAttr("disabled")
    });
    $('[data-toggle="tooltip"]').tooltip()
})